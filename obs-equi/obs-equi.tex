\chapter{Observational
 Equivalence of DAGs}\label{ch-obs-equi}

This chapter is based on Chapter 1 of
Ref.\cite{pearl-2013book}
and on a blog post by 
Bruno Gon\c{c}alves 
(Ref.\cite{bruno-obs-equiv}).



Two DAGs are {\bf observationally
equivalent (OE)}
if they
represent
two 
probability distributions
that cannot
be distinguished
merely
from sampling data of
the states of the nodes.
For example,
$\rva\rarrow\rvb$
and $\rva\larrow\rvb$
are OE because

\beq
P(a|b)P(b)=P(a,b)=P(b|a)P(a)
\label{eq-two-node-prob}
\;.
\eeq

The {\bf
skeleton}
of a DAG is its
undelying undirected graph.

A {\bf v-structure}
in
a DAG consists of
two arrows 
converging to
a node and
such 
that their tails
are not 
connected 
by a third arrow.
Fig.\ref{fig-v-strucs}
shows in red all the v-structures 
of a particular DAG.

\begin{figure}[h!]
$$\xymatrix{
\rvz_1\ar[dd]\ar[rd]
&&\rvz_2\ar@[red][dd]\ar[ld]
\\
&\rvz_3\ar[dl]\ar[dr]
\\
\rvx\ar[r]&\rvw\ar@[red][r]&\rvy
\\
&(a)
}
\xymatrix{
\rvz_1\ar[dd]\ar@[red][rd]
&&\rvz_2\ar[dd]\ar@[red][ld]
\\
&\rvz_3\ar[dl]\ar[dr]
\\
\rvx\ar[r]&\rvw\ar[r]&\rvy
\\
&(b)
}
\xymatrix{
\rvz_1\ar[dd]\ar[rd]
&&\rvz_2\ar[dd]\ar[ld]
\\
&\rvz_3\ar[dl]\ar@[red][dr]
\\
\rvx\ar[r]&\rvw\ar@[red][r]&\rvy
\\
&(c)
}$$
\caption{Example showing in red
all v-structures 
of a particular DAG.}
\label{fig-v-strucs}
\end{figure}





\begin{claim}Observational Equivalence
Theorem (by Verma and Pearl, 1990.)

Two DAGs are
OE
iff they
have the same
skeletons and
the same v-structures.
\end{claim}

\hrule\noindent {\bf Example}

\begin{figure}[h!]
$$\xymatrix{
&\rvx_1
\ar[dl]
\ar[dr]
\\
\rvx_2\ar[dr]
&&\rvx_3\ar[dl]
\\
&\rvx_4\ar[d]
\\
&\rvx_5
\\
&(a)
}
\;\;\;\;\;
\xymatrix{
&\rvx_1
\ar[dr]
\\
\rvx_2\ar[dr]\ar[ur]
&&\rvx_3\ar[dl]
\\
&\rvx_4\ar[d]
\\
&\rvx_5
\\
&(b)
}
\;\;\;\;\;
\xymatrix{
&\rvx_1
\ar[dl]
\\
\rvx_2\ar[dr]
&&\rvx_3\ar[dl]\ar[ul]
\\
&\rvx_4\ar[d]
\\
&\rvx_5
\\
&(c)
}$$
\caption{These 3 DAGs are 
observational equivalent (OE).}
\label{fig-obs-equi-eg}
\end{figure}
\begin{figure}[h!]
$$
\xymatrix{
&\rvx_1
\ar@{-}[dl]\ar@{-}[dr]
\\
\rvx_2\ar[dr]
&&\rvx_3\ar[dl]
\\
&\rvx_4\ar[d]
\\
&\rvx_5
\\
&(c)
}$$
\caption{This partially
directed graph 
represents the 3 
DAGs
in Fig.\ref{fig-obs-equi-eg}.}
\label{fig-pdag1}
\end{figure}

The 3 DAGs
in Fig.\ref{fig-obs-equi-eg}
are OE. They form an equivalence
class of OE DAGs
that can't be distinguished
merely from sampling
data of the 
states of the nodes.
This
equivalence
class of DAGs
can be represented
by the partially 
directed graph 
Fig.\ref{fig-pdag1}.
Here are 3 ways
of proving
that these 3 DAGs are OE:


\begin{enumerate}
\item
Write
the generic
probability
distributions
represented by
the 3 DAGs,
and show
that they are equal, as we did 
in Eq.\ref{eq-two-node-prob}.
That is the low brow way
of proving OE.
\item
Use d-separation
(see Chapter \ref{chap-dsep}).
Consider DAG $(a)$ first.
Label its
nodes in topological
order (i.e., so that 
the parents of $\rvx_j$
have
indices that 
are smaller than $j$).
This is already done.
Now write down 
its total probability
distribution
and notice
which parents
of a fully connected DAG
were omitted.

\beq
P(x_1, x_2, x_3, x_4, x_5)
=
\underbrace{P(x_5|x_4)}
_{x_3, x_2, x_1 \text{ omitted}}
\underbrace{P(x_4|x_3, x_2)}
_{x_1\text{ omitted}}
\underbrace{P(x_3|x_1)}
_{x_2\text{ omitted}}
P(x_2|x_1)P(x_1)
\eeq
The
observations
of which parents
 were omitted
can be stated in d-separation lingo as

\begin{subequations}
\label{eq-oe-ortho}
\beqa
\rvx_3 \perp_P \rvx_2 &|& \rvx_1
\\
\rvx_4 \perp_P \rvx_1 &|& \rvx_2, \rvx_3
\\
\rvx_5 \perp_P (\rvx_1, \rvx_2, \rvx_3) &|& \rvx_4
\eeqa
\end{subequations}
for all $P$, 
or, equivalently, in $G$.

Going through the
same procedure
for the other 2 DAGs yields,
for each of them,
an equivalent set of 3 orthogonality equations.
This is enough to
conclude that the 3 DAGs 
of Fig.\ref{fig-obs-equi-eg}
are OE.

Note that Eqs.(\ref{eq-oe-ortho})
encompass all that
there is to say about the
observability
of DAG $(a)$. These
3 equations
can be checked empirically
to assess how well the DAG fits
the data.
For example,
one can do
OLS (ordinary least squares) regression
$x_5\sim x_1+ x_2 + x_3 + x_4$ 
on the data, i.e., try 
to fit $x_5=
\beta_0 +
\sum_{i=1}^{4}\beta_i x_i$
to the data, and find that,
to a good approximation, 
$\beta_1=\beta_2=\beta_3=0$.




\item
Use the OE Theorem. All three
DAGs have the same
skeleton,
and the same
single
v-structure
$\rvx_2\rarrow\rvx_4\larrow\rvx_3$.




\end{enumerate}

