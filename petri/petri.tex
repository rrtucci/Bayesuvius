\chapter{Petri Nets COMING SOON}
\label{petri}




\newcommand{\petriar}[3]{{\ar@{.>}@/_1pc/[#1]|*++[o][F-]{#2}
\ar[#1]
\ar@{<.}@/^1pc/[#1]|*++[o][F-]{#3}
}}

% downstream red
\newcommand{\petriarDR}[3]{\ar@[red]@{.>}@/_1pc/[#1]|*++[o][F-]{#2}
\ar[#1]
\ar@{<.}@/^1pc/[#1]|*++[o][F-]{#3}
}

% upstream red
\newcommand{\petriarUR}[3]{\ar@{.>}@/_1pc/[#1]|*++[o][F-]{#2}
\ar[#1]
\ar@[red]@{<.}@/^1pc/[#1]|*++[o][F-]{#3}
}



\section{Conventional Petri Nets}
\subsection{Simple Example of Petri Net}

\beq
\xymatrix{
&&*++[o][F-]{0}\ar[rd]
\\
*++[o][F-]{3}\ar[r]_<<<{\rvp_1}
&\rvx_1\ar[ur]_>{\rvp_2}
\ar[dr]
&&\rvx_2\ar[r]_>>{\rvp_4}
\ar@/_2pc/[lll]
&*++[o][F-]{1}
\\
&&*++[o][F-]{2}\ar[ur]_<{\rvp_3}
}
\eeq

\beq
\xymatrix{
&&*++[F-]{\phantom{0}}\ar[rd]
\\
*++[F-]{\bullet\bullet\bullet}\ar[r]_<<<{\rvp_1}
&\rvx_1\ar[ur]_>{\rvp_2}
\ar[dr]
&&\rvx_2\ar[r]_>>{\rvp_4}
\ar@/_2pc/[lll]
&*++[F-]{\bullet}
\\
&&*++[F-]{\bullet\bullet}\ar[ur]_<<{\rvp_3}
}
\eeq

\beq
W^{\rvx\larrow}=
\begin{array}{c|cc}
&\rvx_1&\rvx_2
\\ \hline
\rvp_1&1&0
\\
\rvp_2&0&1
\\
\rvp_3&0&1
\\
\rvp_4&0&0
\end{array}
,\;
W^{\rvx\rarrow}=
\begin{array}{c|cc}
&\rvx_1&\rvx_2
\\ \hline
\rvp_1&0&1
\\
\rvp_2&1&0
\\
\rvp_3&1&0
\\
\rvp_4&0&1
\end{array}
,\;
W=
W^{\rvx\rarrow}
-W^{\rvx\larrow}=
\begin{array}{c|cc}
&\rvx_1&\rvx_2
\\ \hline
\rvp_1&-1&1
\\
\rvp_2&1&-1
\\
\rvp_3&1&-1
\\
\rvp_4&0&1
\end{array}
\eeq

If

\beq
p=\left[
\begin{array}{c}
p_1
\\
p_2
\\
p_3
\\
p_4
\end{array}
\right]
,\;
x=
\left[
\begin{array}{c}
x_1
\\
x_2
\end{array}
\right]
\eeq

\beq
p(t) =
p(0) + Wx
=
\left[
\begin{array}{c}
p_1(0)-x_1+x_2
\\
p_2(0) + x_1 -x_2
\\
p_3(0)+ x_1-x_2
\\
p_4(0) + x_2
\end{array}
\right]
\eeq

\beq
\xymatrix{
*++[o][F-]{\rvp_2}\ar[dr]
&&*++[o][F-]{\rvp_3}\ar[dl]
\\
&{\rvx_2}\ar[ld]\ar[rd]
\\
*++[o][F-]{\rvp_1}
&&*++[o][F-]{\rvp_4}
}
\eeq

\beq
\begin{array}{c|cccc}
&\rvp_1&\rvp_2&\rvp_3&\rvp_4
\\
\hline
\rvx_2&1&-1&-1&1
\end{array}
\eeq

\subsection{Precise Definition of Petri Net}
Let

$\ZZ_{>0}= \{1, 2, 3, \dots\}$ natural numbers.

$\ZZ_{\geq 0}= \{0, 1, 2, 3, \dots\}$ natural numbers and zero.

\hrule
$\rvp_i =$ ith {\bf place  (a.k.a. buffer, token holder) node}. This node holds either
an integer $\geq 0$ or that number of tokens (tokens are represenxed by bullet points).

$\calp = \{\rvp_i\}_{i=1}^{np}$, set of all places


Let $\ket{\rvp_i}\in \ZZ^{np\times 1}$ be the one-hot 
column vector with
$1$ at position $i$. This will be our {markings or places basis}

\hrule 

$\rvx_i =$ ith {\bf transition node}



$\calx = \{\rvx_i\}_{i=1}{nx}$, set of all transitions

Let $\ket{\rvx_j}\in \ZZ^{nx\times 1}$ be the one-hot 
column vector with
$1$ at position $j$. This will be our {transitions basis}.

\hrule

$\rvx\rarrow \rvy$ denotes an {\bf arrow (a.k.a. directed arc)}. Note that there are two type of arrows:
those that go from an transition to a place node and those which go from a place to
a transition node. Let $\rvx\rarrow\rvy=\rvy\larrow \rvx = (\rvx,\rvy)$

$\cala =$  the set of all arrows. $\cala \subset \ol {\cala} = (\calp \times \calx) \cup (\calx \times \calp) = \{\calp\rarrow\calx or \calx \rarrow \calp:
\rvp\in\calp, \rvx \in \calx\}$.


A {\bf flow} is a directed path of arrows from $\cala$.

\hrule
$\mu : \calp \rarrow \ZZ_{\geq 0}=$ {\bf markings (i.e., contents) of of each place}. Sometimes, it is convenient to consider a fractional number tokens in a place, so
$\mu : \calp \rarrow \RR_{\geq 0}$.



$\kappa : \cala\rarrow \ZZ_{>0}=$ {\bf capacity of each arrow}. If unstated, assume $\kappa(a) = 1$.
for all $a\in\cala$. It's also possible to extend the domain of 
$\kappa()$ to $\ol{\cala}$ and define $\kappa(a) = 0$
for all $a\in \ol{\cala}-\cala$. Sometimes, it is convenient to consider a fractional arrow capacity, so
$\kappa : \cala \rarrow \RR_{\geq 0}$.

\hrule
$W^{\rvx \larrow} \in \bool^{np\times nx}$. 
$W^{\rvx \larrow}_{i,j} = 1$ if there is an arrow $\rvp_i\rarrow\rvx_j$
(entering $\rvx_j$);
else $W^{\rvx \larrow}_{i,j} = 0$. More generally, in the case a capacity function $\kappa()$ is given, let

\beq
W^{\rvx \larrow}_{i,j} = \kappa(\rvp_i\rarrow \rvx_j)
\eeq
In Dirac notation, 

\beq
W^{\rvx \larrow} = \sum_{i,j}\kappa(\rvp_i\rarrow \rvx_j)
\ket{\rvp_i}\bra{\rvx_j}
\eeq


$W^{\rvx \rarrow} \in \bool^{np\times nx}$. 
$W^{\rvx \rarrow}_{i,j} = 1$ if there is an arrow $\rvp_i\larrow\rvx_j$
(leaving $\rvx_j$);
else $W^{\rvx \rarrow}_{i,j} = 0$. More generally, in the case a capacity function $\kappa()$ is given, let

\beq
W^{\rvx \rarrow}_{i,j} = \kappa(\rvp_i\larrow \rvx_j)
\eeq
In Dirac notation, 

\beq
W^{\rvx \rarrow} = \sum_{i,j}\kappa(\rvp_i\larrow \rvx_j)
\ket{\rvp_i}\bra{\rvx_j}
\eeq

$W =W^{\rvx \rarrow}-W^{\rvx \rarrow}\in \{-1, 0, 1\}^{np\times nx}$ This is called the {\bf incidence matrix}.
More generally, if a capacity function is given, 

\beq
W_{i,j} =
 W^{\rvx \rarrow}_{i,j}-W^{\rvx \larrow}_{i,j}=
\kappa(\rvp_i\rarrow \rvx_j)
-
\kappa(\rvp_i\larrow \rvx_j)
\eeq
In Dirac notation, 

\beq
W =  \sum_{i,j}\left[
\kappa(\rvp_i\rarrow \rvx_j)
-
\kappa(\rvp_i\larrow \rvx_j)
\right]
\ket{\rvp_i}\bra{\rvx_j}
\eeq

\hrule
$\rvx^\larrow = \{\rvp : \rvp \rarrow \rvx\in\cala\}=$ {\bf $\rvx$ input places (a.k.a. $\rvx$ pre-set)}

$\rvx^\rarrow = \{\rvp : \rvx \rarrow \rvp \in \cala\}=$ {\bf $\rvx$ output places (a.k.a. $\rvx$ post-set)}

$\rvp^\larrow = \{\rvx : \rvx \rarrow \rvp \in \cala \}=$ {\bf$\rvp$ input transitions (a.k.a. $\rvp$ preset)}

$\rvp^\rarrow = \{\rvx : \rvp \rarrow\rvx \in\cala\}=$ {\bf $\rvx$ output transitions (a.k.a. $\rvp$ post-set)}

\hrule
$\ket{p(0)}\in \ZZ_{\geq 0}^{np\times 1} =$ {\bf initial markings}

$\Phi = \av{\calp, \calx,\ket{p(0)}, W}$ is a {\bf Petri net}.
\subsection{Execution of a Petri net}
Consider a Petri Net $\Phi = \av{\calp, \calx,\ket{p(0)}, W}$.
%By firing step of a transition x, we mean the action of removing μ(p → x)
%tokens from all p such that p → x ∈ {◦ → x}, and adding μ(x → p′) tokens to all p′
%such that x → p′ ∈ {x → ◦}.
%A transition x is enabled, i.e., it may fire if there are enough tokens in
%the input places of x for a firing to be possible; i.e., if M(p) ≥ μ(p → x) for all p.
%t ∈ Z>0 is the firing time.
%p(t) = markings at firing time t.
%x(t) = how many times each transition occurs at time t.
%p(t) = p(0) +Wx(t) (74.7)
%p(0), p(1), p(2), . . . is the sequence of firings
%A marking p∗ is reachable from a marking p in n = 1, 2, . . . steps if
%p can be transformed to p∗ by executing n firings. We write p Φ / p∗ and say a
%marking p∗ is reachable from a marking p if p∗ is reachable from p in a finite
%number of steps.
%The reachability set of a Petri Net Φ with initial markings p(0) is defined as
%R(Φ) = {p∗ : p(0) Φ / p∗ } (74.8)
%555
\section{Generalizations}
\subsection{Continuous Petri net}
%Replace pi → dxi
%dt = x˙i(t) for all i = 1, 2, . . . , np.
%x˙(t) = x˙(0) +Wx(t) (74.9)
\subsection{Colored Petri Nets}
\subsection{Stochastic Petri Nets}
\subsection{Petri-Bayes Net}
{\bf Petrifying a Bnet}

\beq
\xymatrix@C=5pc{
\rvx
\ar[r]
&\rvy
}
\;\;\;\;\;\;
\implies
\;\;\;\;\;\;
\xymatrix@C=5pc{
\rvx
\petriar{r}{2}{3}
&\rvy
}
\eeq


%x / y =⇒ x /
%3
%&
%f 2
%y (74.10)
%We will refer to the place between x and y as px,y.
%a
%b 􀀀 /
%c
%􀀀
%d
%=⇒
%a
%􀀀
%3
%v
%6
%5
%V
%b /
%2
%j *
%1
%U
%c
%􀀀
%5
%v
%6
%d
%(74.11)
{\bf Petri-Bayes Net}
%a
%3
%U
%b
%􀀀
%2
%u
%5
%x
%3
%U
%􀀀
%4
%u
%5
%c d
%pa→x px→c px→d
%· · ·
%x −1 1 1 0
%(74.12)
%556
%a
%3
%U
%b
%􀀀
%2
%v
%5
%x
%3
%U
%􀀀
%4
%u
%6
%c d
%pa→x px→b
%· · ·
%x −1 1 0
%a
%3
%U
%b
%
%2
%u
%5
%x
%3
%U
%􀀀
%4
%u
%5
%c y d
%pa→x px→b
%· · ·
%x −1 1 0
%(74.13)
%a
%3
%U
%b
%􀀀
%2
%u
%5
%x
%3
%U
%􀀀
%4
%u
%5
%c d
%pc→x px→a px→b px→d
%· · ·
%x −1 1 1 1 0
%a
%3
%U
%b
%􀀀
%2
%v
%5
%x
%3
%U
%􀀀
%4
%u
%6
%c d
%pc→x
%· · ·
%x −1 0
%(74.14)
%557
%
\beq
\begin{array}{ccc}
\xymatrix@R=5pc@C=5pc{
&\rva\ar[dl]\ar[dr]
\\
\rvb\ar[rr]\ar[dr]
&&\rvc\ar[dl]
\\
&\rvd
}
&\xymatrix@R=5pc{
\\
&\implies&}
&
\xymatrix@R=5pc@C=5pc{
&\rva\petriar{dl}{1}{}
\petriar{dr}{}{5}
\\
\rvb\petriar{rr}{}{2}
\petriar{dr}{5}{}
&&\rvc\petriar{dl}{3}{}
\\
&\rvd
}
\end{array}
\eeq

\beq
\begin{array}{c}
\xymatrix@R=5pc@C=5pc{
\rva\petriarDR{dr}{}{}
&&\rvb\petriar{dl}{}{}
\\
&\rvx
\petriarDR{dr}{}{}
\petriarDR{dl}{}{}
\\
\rvc
&&\rvd
}
\\
\begin{array}{c|cccc}
&\rvp_{a\rarrow x}
&\rvp_{x\rarrow c}
&\rvp_{x\rarrow d}
&\cdots
\\ \hline
\rvx&-1&1&1&0
\end{array}
\end{array}
\eeq