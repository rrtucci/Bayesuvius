\chapter{ANOVA (COMING SOON)}
\label{ch-ANOVA}

ANOVA 
stands for ``Analysis of Variance".

\section{Law of Total Variance}

\begin{claim}
(Law of Total Variance)
Suppose $P:S_\rvx\times S_\rvy\rarrow [0,1]$
is a probability distribution.
Suppose $f:S_\rvx\times S_\rvy\rarrow \RR$
 and $f=f(x,y)$. Then
\beq
Var_{\rvx, \rvy}(f)=
E_\rvy[Var_{\rvx|\rvy}(f)]
+
Var_\rvy(E_{\rvx|\rvy}[f])
\;.
\eeq
In particular,
\beq
Var_{\rvx}(x)=
E_\rvy[Var_{\rvx|\rvy}(x)]
+
Var_\rvy(E_{\rvx|\rvy}[x])
\;.
\eeq

\end{claim}
\proof

Let
\beq
A=\sum_y P(y)\left(\sum_x P(x|y)f\right)^2
\;.
\eeq
Then

\beqa
Var_{\rvx, \rvy}(f)&=& \sum_{x,y}P(x,y)f^2 -
\left( \sum_{x,y} P(x,y) f\right)^2
\\
&=&
\left\{
\begin{array}{l}
\sum_{x,y}P(x,y)f^2
-A
\\
+\left(A-\left( \sum_{x,y} P(x,y) f\right)^2\right)
\end{array}
\right.
\eeqa

\beqa
E_\rvy[Var_{\rvx|\rvy}(f)]
&=&
\sum_y P(y)\left(\sum_x P(x|y)f^2
-
\left(\sum_x P(x|y)f\right)^2
\right)
\\
&=&
\sum_{x,y}P(x,y)f^2
-A
\eeqa

\beqa
Var_\rvy(E_{\rvx|\rvy}[f])
&=&
\sum_y P(y)
\left(\sum_x P(x|y)f\right)^2
-\left(
\sum_y P(y)\sum_xP(x|y)f
\right)^2
\\
&=&
A-\left( \sum_{x,y} P(x,y) f\right)^2
\eeqa
\qed

\section{Sum of Squares Estimates}
Consider 
a population $\Sigma$
partitioned 
into groups $\Sigma_g$
such that
$\Sigma=\cup_{g=1}^{ng}\Sigma_g$,
where the 
$\Sigma_g$ are mutually disjoint.

Let

$dof$ stand for
``degrees of freedom"

SS stand for ``Sum of Squares"

$x_{\Sigma_g}=
\{x_{\s, g}\}_{\s\in\Sigma_g}$

Define the {\bf SS Total} by
\beqa
SST
&=&\sum_{g=1}^{ng}\sum_{\s\in\Sigma_g}
(x_{\s|g}- \ol{x})^2
\\
&=&
|\Sigma| Var_{\rvx}(x)
\eeqa

\beq
dof(SST)=|\Sigma|-1
\eeq

Define the {\bf SS Within} by

\beqa
SSW &=& \sum_{g=1}^{ng}
\sum_{\s\in\Sigma_g}(x_{\s|g}- \ol{x}_g)^2
\\
&=&|\Sigma|
\sum_{g=1}^{ng}
\frac{|\Sigma_g|}{|\Sigma|}
\left\{
\frac{1}{|\Sigma_g|}
\sum_{\s\in\Sigma_g}
(x_{\s|g}- \ol{x}_g)^2
\right\}
\\
&=&
|\Sigma|
E_\rvg[
Var_{\rvx|\rvg}(x)
]
\eeqa
\beq
dof(SSW)=|\Sigma|-ng
\eeq

Define the {\bf SS Between} by


\beqa
SSB
&=&\sum_{g=1}^{ng}
|\Sigma_g|( \ol{x}_g -  \ol{x})^2
\\
&=&|\Sigma|
\sum_{g=1}^{ng}
\frac{|\Sigma_g|}
{|\Sigma|}( 
\underbrace{\ol{x}_g}
_{E_{\rvx|\rvg}[x]} -  \ol{x})^2
\\
&=&
|\Sigma|
Var_\rvg(
E_{\rvx|\rvg}[x])
\eeqa

\beq
dof(SSB)= ng-1
\eeq





\begin{claim}
\beq
SST=SSW+SSB
\eeq

\beq
dof(SST)=dof(SSW) + dof(SSB)
\eeq
\end{claim}
\proof
\beq
\underbrace{Var_{\rvx}(x)}
_{SST/|\Sigma|}
=
\underbrace{E_\rvg[
Var_{\rvx|\rvg}(x)
]}
_{SSW/|\Sigma|}
+
\underbrace{Var_\rvg(
E_{\rvx|\rvg}[x])
}
_{SSB/|\Sigma|}
\;.
\eeq


\qed



\begin{figure}[h!]
$$\xymatrix{
\rvx_{\Sigma_1}\ar@/^2pc/[rrrr]
\ar[d]\ar@/_1pc/[dd]
&\rvx_{\Sigma_2}\ar@/^2pc/[rrr]
\ar[d]\ar@/_1pc/[dd]
&\rvx_{\Sigma_3}\ar@/^2pc/[rr]
\ar[d]\ar@/_1pc/[dd]
&\ol{\rvx}\ar[r]\ar[rd]
&\ul{SST}
\\
\ol{\rvx}_1\ar@/^2pc/[rrrr]\ar[d]
&\ol{\rvx}_2\ar@/^2pc/[rrr]\ar[d]
&\ol{\rvx}_3\ar@/^2pc/[rr]\ar[d]
&
&\ul{SSW}
\\
\ul{V}_1\ar@/^2pc/[rrrr]
&\ul{V}_2\ar@/^2pc/[rrr]
&\ul{V}_3\ar@/^2pc/[rr]
&
&\ul{SSB}
}$$
\caption{Bnet 
for calculating $SST$, $SSW$ and $SSB$.}
\label{fig-bnet-ANOVA}
\end{figure}

Fig.\ref{fig-bnet-ANOVA}
shows a bnet for
calculating $SST$,
$SSW$ and $SSB$,
The TPMs, 
printed in blue,
for the bnet 
Fig.\ref{fig-bnet-ANOVA},
are as follows.
\beq\color{blue}
P(\ol{x}|\{x_{\Sigma_g}\}_{g=1}^{ng}) =\indi\left(
\ol{x}=
\frac{1}{|\Sigma|}
\sum_{g=1}^{ng}
\sum_{\s\in\Sigma_g}x_{\s|g}
\right)
\eeq


\beq\color{blue}
P(\ol{x}_g|x_{\Sigma_g}) =\indi\left(
\ol{x}_g=
\frac{1}{|\Sigma_g|}
\sum_{\s\in\Sigma_g}x_{\s|g}
\right)
\eeq

\beq\color{blue}
P(V_g|x_{\Sigma_g}, \ol{x}_g) =\indi\left(
V_g=
\frac{1}{|\Sigma_g|}
\sum_{\s\in\Sigma_g}
(x_{\s|g} -\ol{x}_g)^2
\right)
\eeq

\beq\color{blue}
P(SST|\{x_{\Sigma_g}\}_{g=1}^{ng},
\ol{x}) =\indi(
SST=SST()
)
\eeq

\beq\color{blue}
P(SSB|\{\ol{x}_g\}_{g=1}^{ng},
\ol{x}) =\indi(
SSB=SSB()
)
\eeq

\beq\color{blue}
P(SSW|\{V_g\}_{g=1}^{ng}) =\indi(
SSW=SSW()
)
\eeq

\section{F-statistic and hypothesis testing}