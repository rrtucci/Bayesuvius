\newcommand{\bnetInstantiations}[0]{
Random variables are underlined
and their values are not.
For example, $\rva=a$ means
the random variable
$\rva$ takes the value $a$.
A diagram
with all its nodes
underlined represents a
Bayesian Network (bnet),
whereas the same diagram
with the letters not underlined
represents a specific
{\bf instantiation} of that bnet.
For example $\rva\rarrow\rvb\rarrow \rvc$
represents the bnet with
full probability distribution
$P(c|b)P(b|a)P(a)$,
whereas  $a\rarrow b\rarrow c$
represents $P(c|b)P(b|a)$. Note that, for convenience,
we define $a\rarrow b\rarrow c$ to
exclude the priors of root nodes such as $P(a)$.

If $\rva$ is a root node,
then $\EE a$ signifies
a weighted sum $\sum_a P(a)$.
For example,

\beq\EE a\rarrow b\rarrow c=\sum_a P(c|b)P(b|a)P(a)
\eeq
If $\rva$ is not
a root node, then
$\sum a$ signifies
a simple unweighted sum $\sum_a$.
For example,

\beq
x\rarrow\sum a \rarrow y=
\sum_a P(y|a)P(a|x)
\eeq

Two bnets are said to be equal if their full probability
distributions (i.e.,
their full instantiations) are equal numerically.
For example,
\beq
\rva\rarrow\rvb\rarrow \rvc = P(c|b)P(b|a)P(a)= \rva\larrow\rvb\larrow\rvc
\eeq}

\newcommand{\hiddenNodes}[0]{
Unobserved (a.k.a. hidden, latent) nodes are
indicated in a bnet by enclosing their
label
in a dashed circle. For example,
$\xymatrix{*++[F-o]{u}}$.
Alternatively, they are indicated by
using dashed arrows for all arrows emanating from the unobserved node.}



\newcommand{\selectionGraphs}
[0]{In a selection diagram
with a switch node $\rvs\in \bool$,
if  a node $\rvx$
has parents $pa(\rvx)$
where $\rvs\not\in pa(\rvx)$,
then the
TPM of $\rvx$ is $P(x|pa(x))$.
If, on the other hand,
$\rvx$ has
parents $pa(\rvx)=pa^-(\rvx)\cup
\rvs$, where $pa^-(\rvx)=pa(\rvx)-\rvs$, then
the TPM of $\rvx$ is

\beq
P(x|pa^-(x), s)=
\left\{
\begin{array}{ll}
P(x|pa^-(x))& \text{ if } s=0
\\
P^*(x|pa^-(x))
& \text{ if } s=1
\end{array}
\right.
\eeq
}

\newcommand{\decBackDoor}[0]{
 (Backdoor
Adjustment Formula)

If
$
\xymatrix{
{\rvz}\ar[d]\ar[rd]
\\
\rvx\ar[r]&\rvy
}$
then

\beqa
P(y|\cald \rvx = x)
&=&
\sum_z
P(y|x,z)P(z)
\\
&=&
\xymatrix{
\EE z\ar[dr]
\\
x\ar[r]
&y
}
\eeqa
}



\newcommand{\decFrontDoor}[0]{(Frontdoor
Adjustment Formula)

If
$
\xymatrix{
&*++[F-o]{\rvc}\ar[ld]\ar[rd]
\\
\rvx\ar[r]&\rvm\ar[r]&\rvy
}$
then
\beqa
P(y|\cald \rvx = x)&=&
\sum_m
\left[
\sum_{x'}P(y|x',m)P(x')
\right]P(m|x)
\\
&=&
\xymatrix{
&\EE x'\ar[dr]
\\
x\ar[r]
&\sum m\ar[r]&y
}
\eeqa
Using the node summation identities, 
the $\sum m.$ may be removed from the final instantiation, 
leaving a result similar to
the backdoor adjustment formula, but it
is usually left explicit.
}


\newcommand{\decNapkin}[0]{(Napkin problem from Ref.\cite{book-why})

If $
\xymatrix{
&*++[F-o]{\rvu_1}\ar[ddl]\ar[ddrr]
\\
&*++[F-o]{\rvu_2}\ar[dl]\ar[dr]
\\
\rvw\ar[r]
&\rvz\ar[r]
&\rvx\ar[r]
&\rvy
}$ then
\begin{align}
P(y|\cald \rvx = x)
&=
P(y|x)
\\
&=
\xymatrix{
\EE z\ar[dr]
\\
x \ar[r]&  y}
\end{align}
}

\newcommand{\decWhy}[0]{(from Ref.\cite{book-why})

If $
\xymatrix{
\rvx\ar[d]\ar[drr]
\\
\rvw\ar[r]
&\rvz\ar[r]
&\rvy
\\
*++[F-o]{\rvu}\ar[u]\ar[urr]
}$ then
\beqa
P(y|\cald\rvz=z, x)
&=&
\sum_w
P(y|z,x,w)P(w)
\\
&=&
\xymatrix{
x\ar[rrd]
\\
\EE w\ar@/_1pc/[rr]
&z\ar[r]
&y
}\eeqa
}


\newcommand{\decTransportTrivial}[0]
{(Trivial Memoryless
 Transportability,
from Ref.\cite{pearl2011trans})

If $
\xymatrix{
&\rvz\ar[ld]\ar[rd]
&\rvs\ar[d]
\\
\rvx\ar[rr]
\ar@{<-->}@/^1pc/[ru]
\ar@{<-->}@/_1pc/[rr]
&&\rvy
}$
where $\rvs\in\bool$ is a
switch node,
then

\beq
P^*(y|\cald \rvx=x, z)=P^*(y|x, z)
\quad
\text{(replace $\cald$ by $1$,
keep $P^*$)}
\eeq

\beq
\xymatrix{
&z\ar[rd]
&\rvs=1\ar[d]
\\
\cald\rvx=x\ar[rr]
&&y
}
\xymatrix{
\\=
}
\xymatrix{
&z\ar[rd]
&\rvs=1\ar[d]
\\
x\ar[rr]
&&y
}
\eeq
}

\newcommand{\decTransportDirect}[0]
{(Direct
 Transportability, a.k.a.
External Validity,
from Ref.\cite{pearl2011trans})

If $
\xymatrix{
\rvs\ar[r]
&\rvz\ar[ld]\ar[rd]
&
\\
\rvx\ar[rr]
\ar@{<-->}@/^1pc/[ru]
\ar@{<-->}@/_1pc/[rr]
&&\rvy
}$
where $\rvs\in\bool$ is a
switch node,
then

\beq
P^*(y|\cald\rvx=x, z)=
P(y|\cald\rvx=x, z)
\quad
\text{(replace $P^*$ by $P$,
keep $\cald$)}
\eeq

\beq
\xymatrix{
\rvs=1\ar[r]
&z\ar[dr]
&
\\
\cald\rvx=x\ar[rr]
&&y
}
\xymatrix{\\=}
\xymatrix{
&z\ar[dr]
&
\\
\cald\rvx=x\ar[rr]
&&y
}\eeq
Furthermore,
\beq
P^*(y|\cald \rvx=x)=
\sum_z
P(y|\cald \rvx=x,z)P^*(z)
\eeq

\beq
\xymatrix{
\rvs=1\ar[drr]
\\
\cald \rvx=x\ar[rr]
&&y
}\xymatrix{\\=}
\xymatrix{
\rvs=1\ar[r]
&\sum z\ar[rd]
\\
\cald\rvx=x\ar[rr]
&&y
}
\eeq
}



\newcommand{\decTransportBox}[0]
{(S-Admissible Transportability,
from Ref.\cite{pearl2011trans})

If
$
\xymatrix{
\rvs\ar[r]
&*++[F-o]{\rvz}\ar[r]\ar[ld]
&\rva\ar[d]
\\
\rvx\ar[rr]
\ar@{<-->}@/^1pc/[ru]
\ar@{<-->}@/_1pc/[rr]
&&\rvy
\\
\\
}$
where $\rvs\in\bool$ is a
switch node,
then

\beq
P^*(y|\cald \rvx=x)=
\sum_{a}P(y|\cald \rvx=x, a)P^*(a)
\eeq
\beq
\xymatrix{
\rvs=1\ar[dr]
\\
\cald \rvx=x\ar[r]
&y
}\xymatrix{\\=}
\xymatrix{
\rvs=1\ar[r]
&\sum a\ar[d]
\\
\cald \rvx=x\ar[r]
&y
}
\eeq
}

%\decTransportOne merged
%with decDirectTransport

\newcommand{\decTransportNon}[0]
{(Non-transportability,
from Ref.\cite{pearl2011trans})

If $
\xymatrix{
&*++[F-o]{\rvh}\ar[ld]\ar[rd]
&\rvs\ar[d]
\\
\rvx\ar[rr]
&&\rvy
}$
where $\rvs\in\bool$ is a
switch node,
then

\beq
P^*(y|\cald \rvx=x)=
P^*(y|\cald\rvx=x)
\eeq

\beq
\xymatrix{
&
&\rvs=1\ar[d]
\\
\cald\rvx=x\ar[rr]
&&y
}
\xymatrix{
\\=\text{same}
}
\eeq
}

\newcommand{\decTransportTwo}[0]{(from Ref.\cite{pearl2011trans})
\\
\\

If
$\xymatrix{
\rvs\ar@/^1.5pc/[rr]
&*++[F-o]{\rvh}\ar[dl]\ar[dr]\ar[r]
\ar@{<-->}@/_1pc/[dl]
&\rvz
\\
\rvx\ar[rr]\ar@{<-->}@/_1pc/[rr]
&&\rvy
}$
where $\rvs\in\bool$ is a
switch node,
then

\beq
P^*(y|\cald \rvx=x)=
P(y|\cald \rvx=x)
\eeq
\beq
\xymatrix{
\rvs=1\ar[drr]
\\
\cald \rvx=x\ar[rr]
&&y
}\xymatrix{\\=}
\xymatrix{
\\
\cald \rvx=x\ar[rr]
&&y
}
\eeq
}

\newcommand{\decTransportThree}[0]{(from Ref.\cite{pearl2011trans})

If
$\xymatrix{
\rvs\ar[rd]
&*++[F-o]{\rvh}\ar[dl]\ar[dr]
\ar@{<-->}@/_1pc/[dl]
\\
\rvx\ar[r]\ar@{<-->}@/_1pc/[rr]
&\rvz\ar[r]
&\rvy
}$
where $\rvs\in\bool$ is a
switch node,
then

\beq
P^*(y|\cald \rvx=x)=
\sum_z
P(y|\cald \rvx=x, z)P^*(z|x)
\eeq
\beq
\xymatrix{
\rvs=1\ar[dr]
&\cald\rvx=x\ar[d]
\\
&y
}
\xymatrix{
\\=}
\xymatrix{
\rvs=1\ar[rd]
&&\cald\rvx=x\ar[d]
\\
x\ar[r]
&\sum z\ar[r]
&y
}
\eeq
}

\newcommand{\decMediationSimple}
[0]{(Unconfounded Mediation,
from Ref.\cite{pearl-2019review})

If
$\xymatrix{
&\rvm\ar[rd]
\\
\rvd\ar[rr]\ar[ru]
&&\rvy}$
then

\beq
P(y|\cald\rvd=d, \cali_\rvm\rvd=d')=
\sum_m
P(y|d, m)
P(m|d')
\eeq

\beq
\xymatrix{
\cali\rvd=d'\ar[rd]
\\
\cald\rvd=d\ar[r]
&y
}
\xymatrix{\\=}
\xymatrix{
\cali\rvd=d'\ar[r]
&\sum m\ar[rd]
\\
\cald \rvd=d\ar[rr]
&&y}
\eeq
}

\newcommand{\decMediationPlus}
[0]{(Mediation
with universal prior $\rvxi$
and universal confounder $\rvu$,
from Ref.\cite{pearl-2019review})

If
$\xymatrix{
&*++[F-o]{\rvu}\ar[dl]
\ar[ddr]\ar[ddl]\ar[d]
\\
\rvxi\ar[rrd]\ar[d]\ar[r]
&\rvm\ar[rd]
\\
\rvd\ar[rr]\ar[ru]
&&\rvy}$
then

\beq
P(y|\cald\rvd=d, \cali_\rvm\rvd=d')=
\sum_\xi
\sum_m
P(y|d, m, \xi)
P(m|d', \xi)P(\xi)
\eeq

\beq
\xymatrix{
\cali\rvd=d'\ar[rd]
\\
\cald\rvd=d\ar[r]
&y
}
\xymatrix{\\=}
\xymatrix{
\cali\rvd=d'\ar@/_1pc/[rr]
&\EE\xi\ar[rrd]\ar[r]
&\sum m\ar[rd]
\\
\cald \rvd=d\ar[rrr]
&&&y}
\eeq
}


\newcommand{\decSeqBackDoor}[0]{(Sequential
backdoor (SBD) adjustment formula,
from Ref.\cite{pearl-robins-95})

If
\xymatrix{
\rvz_0\ar[r]\ar@/^1pc/[rr]\ar[drrr]
\ar[dd]
&\rvz_1\ar[r]\ar[drr]
\ar[dd]
&\rvz_2\ar[dr]
\ar[dd]
\\
&&&\rvy
\\
\rvx_0\ar[uur]\ar[uurr]\ar[urrr]
\ar[r]\ar@/_1pc/[rr]
&\rvx_1\ar[uur]
\ar[urr]\ar[r]
&\rvx_2
\ar[ur]
}
then

\beq
P(y|\cald \rvx^3=x^3)
=
\calq(y|x^3)
\eeq
\beq
\xymatrix{\\
\cald \rvx^3=x^3\ar[r]&y}
\xymatrix{\\=}
\xymatrix{
\EE z_0\ar[r]\ar@/^1pc/[rr]
\ar[drrr]
&\sum z_1\ar[r]
\ar[drr]
&\sum z_2
\ar[dr]
\\
&&&y
\\
x_0\ar[uur]\ar[uurr]
\ar[urrr]
&x_1\ar[uur]
\ar[urr]
&x_2
\ar[ur]
}
\eeq
The result
shown here for $n=3$
is true for any integer $n\geq 1$.
}

\newcommand{\decSBBackDoor}[0]{
 (Selection Bias (SB) Backdoor
Adjustment Formula,
from Ref.\cite{bare-sb-removal})
\\
\\
If
$
\xymatrix{
\rvs\ar[d]\ar[r]\ar@/^1pc/[rr]
&\rvz^{<\rvx}\ar[ld]\ar[d]\ar[r]
&\rvz^{>\rvx}
\\
\rvx\ar[rru]\ar[r]
&\rvy
}$
where $\rvs\in\bool$
is a switch node and
$\rvz=(\rvz^{<\rvx}, \rvz^{>\rvx})$,
then
\beq
P(y|\cald\rvx=x, \rvs=1)
=
\sum_z P(y|x,z)P(z)=P(y|x)
\eeq

\beq
\xymatrix{
\rvs=1
\ar[rd]
\\
\cald\rvx=x\ar[r]
&y
}
\xymatrix{\\=}
\xymatrix{
&\EE z \ar[d]
\\
x\ar[r]
&y}
\\
\xymatrix{\\=}
\xymatrix{
\\
x\ar[r]&y
}
\eeq
}
