\chapter{Linear Deterministic Bnets 
with External 
Noise}\label{ch-linear-sys}

In this chapter, we will consider 
bnets which were referred to,
prior to the invention of bnets, as:
Sewall Wright's {\bf Path Analysis (PA)}
 and
{\bf linear Structural Equations Models (SEM)}.
Judea Pearl in his
books calls them
{\bf linear Structural Causal Models (SCM)},
because they are very 
convenient for doing causal analysis.
We will refer  to
them as linear  Deterministic with 
External Noise
 (LDEN) diagrams.
This chapter
is devoted to LDEN diagrams,
except that we will
say a few words
about non-linear DEN
diagrams at the end.


A {\bf DEN diagram}
is a special kind of bnet.
To 
build a DEN diagram,
start with a 
deterministic bnet $G$.
The deterministic
nodes of $G$ are called
the {\bf endogenous (internal) variables}.
Now make a bigger bnet $\ol{G}$
called a DEN diagram
by 
adding to each node $\rva$ of $G$ a
non-deterministic  
root node $\rvu_\rva$
pointing into $\rva$ only.
The nodes $\rvu_\rva$ are called
the {\bf exogenous (external) variables}.
The exogenous
variables make their children noisy.
They are assumed 
to be unobserved
and their TPMs are prior
probability distributions.
Since they are 
root nodes, they are 
mutually independent.
When we
draw
a DEN diagram,
we will
never draw the exogenous nodes,
leaving them implicit.

A {\bf linear DEN diagram (LDEN)} is 
a DEN diagram
whose deterministic nodes
have a TPM that is a linear 
function of the states
of the parent nodes.


\section{Example
of LDEN diagram}


\begin{figure}[h!]
$$\xymatrix{
&\rvx\ar[dl]_\beta\ar[dr]^\alp
\\
\rvw\ar[dr]_\epsilon&&\rvz\ar[ll]_\gamma\ar[dl]^\delta
\\
&\rvy
}$$
\caption{
Example of a LDEN diagram wherein
$\rvx$ splits
into two nodes $\rvz$
and $\rvw$,
then merges into node $\rvy$.
There is also an arrow
$\rvz\rarrow \rvw$.
Exogenous
nodes are not shown.
The Greek letters
represent 
real numbers.
}
\label{fig-scm-diamond}
\end{figure}

The TPMs, printed in blue,
for the nodes of the LDEN diagram 
Fig.\ref{fig-scm-diamond},
are as follows.

\beq\color{blue}
P(y|w, z, u_\rvy)=
\indi(y=\epsilon w +\delta z
+ u_\rvy)
\eeq

\beq\color{blue}
P(w|x, z, u_\rvw)=
\indi(w=\beta x +\gamma z + u_\rvw)
\eeq

\beq\color{blue}
P(z|x, u_\rvz)=
\indi(z=\alpha x + u_\rvz)
\eeq

\beq\color{blue}
P(x|u_\rvx)=
\indi(x=u_\rvx)
\eeq

Hence,
\beqa
y&=&
\epsilon w +\delta z
+ u_\rvy
\\
&=&
\epsilon (\beta x +\gamma z + u_\rvw)
 +\delta z
+ u_\rvy
\\
&=&
(\epsilon\gamma + \delta)z
+ \epsilon\beta x
+\epsilon u_\rvw+ u_\rvy
\\
&=&
(\epsilon\gamma + \delta)z
+ \epsilon\beta u_\rvx
+\epsilon u_\rvw+ u_\rvy\;.
\eeqa
Therefore

\beq
\left(\pder{y}{z}\right)_{u.-u_\rvz}=
\epsilon\gamma + \delta
\;,
\eeq
where the
partial
derivative holds fixed
all
exogenous
variables except
$u_\rvz$.
Note that
this partial
derivative is a 
sum of terms,
and that each of those terms
represents a different
directed path
from $\rvz$ to $\rvy(\rvz)$.
This
is a general
property
of LDEN diagrams.


\section{Fully Connected 
LDEN diagrams}
The bnets that will be
considered in this section
will all be fully connected.
Fully connected
bnets are
defined in Chapter \autoref{ch-bnet-def}.
This section 
uses the notation
$\av{\rvx, \rvy}$
for the
covariance
of any two random variables $\rvx, \rvy$.
This $\av{\rvx, \rvy}$ notation
is defined in the 
Notational
Conventions Chapter \autoref{ch-not-cons}.


Consider a LDEN diagram
with 
deterministic nodes
$\rvx.=(\rvx_k)_{k=0, 1, \ldots nx-1}$
and 
corresponding exogenous nodes 
$\rvu.=(\rvu_k)_{k=0, 1, \ldots nx-1}$.
Assume $\av{\rvu_i, \rvu_j}=0$
if $i\neq j$. The strength
of each 
connection 
$\rvx_i\rarrow \rvx_j$
of the LDEN diagram 
is measured by a
{\bf structural
coefficient} $\alp_{j|i}\in \RR$.
Some of the $\alp_{j|i}$ may
be zero,
in which case
the
corresponding arrow
$i\rarrow j$
would not be drawn.

\subsection{Fully connected 
LDEN diagram with $nx=2$}

\begin{figure}[h!]
$$
\xymatrix{
\rvx_0
\ar[d]^{\alp{1|0}}
\\
\rvx_1
}$$
\caption{
Fully connected 
LDEN diagram with two $\rvx_j$
nodes
(exogenous nodes $\rvu_j$
not shown).}
\label{fig-fully-conn-2}
\end{figure}

Consider the 
LDEN diagram of Fig.\ref{fig-fully-conn-2}.
This diagram represents the 
following {\bf structural equations}:
\begin{subequations}
\label{eq-fully-conn-2}
\beqa
\rvx_0&=&\rvu_0
\\
\rvx_1&=&\alp_{1|0}\rvx_0  + \rvu_1
\;.
\eeqa
\end{subequations}
Eqs.\ref{eq-fully-conn-2}
constitute a system of 2 
linear equations in 2 unknowns
(the $\rvx$'s) so we can solve
for the $\rvx$'s in terms 
of the $\alpha$'s and $\rvu$'s.

Note also that
\beq
\av{\rvx_1, \rvx_0}=
\alp_{1|0}\av{\rvx_0, \rvx_0}
\;.
\eeq
Thus, $\alp_{1|0}$
can be estimated  
from the covariances $\av{\rvx_i, \rvx_j}$.

\subsection{Fully connected 
LDEN diagram with $nx=3$}

\begin{figure}[h!]
$$
\xymatrix{
\rvx_0\ar[d]_{\alp_{1|0}}
\ar[dr]^{\alp_{2|0}}
\\
\rvx_1\ar[r]^{\alp_{2|1}}
&\rvx_2
}$$
\caption{
Fully connected LDEN diagram with 
three $\rvx_j$ nodes
(exogenous nodes $\rvu_j$
not shown).}
\label{fig-fully-conn-3}
\end{figure}

Consider the LDEN diagram
of Fig.\ref{fig-fully-conn-3}.
This diagram represents the 
following {\bf structural equations}:
\begin{subequations}
\label{eq-fully-conn-3}
\beqa
\rvx_0 &=& \rvu_0
\\
\rvx_1&=&\alp_{1|0}\rvx_0 + \rvu_1
\\
\rvx_2&=&\alp_{2|0}\rvx_0 +
\alp_{2|1}\rvx_1 +
\rvu_2
\;.
\eeqa
\end{subequations}
Eqs.\ref{eq-fully-conn-3}
constitute a system of
3 linear  equations in 3 unknowns
(the $\rvx$'s) so we can solve
for the $\rvx$'s in terms 
of the $\alpha$'s and $\rvu$'s.

Note also that
\begin{subequations}
\label{eq-fully-conn-3-covs}
\beqa
\av{\rvx_1, \rvx_0}&=&
\alp_{1|0}\av{\rvx_0, \rvx_0}
\\
\av{\rvx_2, \rvx_0}&=&
\alp_{2|0}\av{\rvx_0, \rvx_0}
+
\alp_{2|1}\av{\rvx_1, \rvx_0}
\\
\av{\rvx_2, \rvx_1}&=&
\alp_{2|0}\av{\rvx_0, \rvx_1}
+
\alp_{2|1}\av{\rvx_1, \rvx_1}
\eeqa
\end{subequations}
Eqs.\ref{eq-fully-conn-3-covs}
constitute a system of
3 linear  equations in 3 unknowns
(the $\alpha$'s) so we can solve
solve for the $\alpha$'s in terms
of covariances $\av{\rvx_i, \rvx_j}$.
This gives an estimate
for the $\alp$'s.


\subsection{Fully
connected 
LDEN diagram with arbitrary $nx$} 

Let $\rvx.=(x_i)_{i=0, 1,
 \ldots, nx-1}$
and $\rvx_{<i}=
(x_k)_{k=0, 1, \ldots, i-1}$.
Consider
a fully connected
LDEN diagram
with  deterministic nodes labeled
$\rvx_i$.
The $\rvx_i$ labels 
are assumed
to be in {\bf topological order}
(i.e., the parents of
node $\rvx_i$ are $\rvx_{<i}$).
Let the TPMs,
printed in blue, for the nodes $\rvx.$
of the 
LDEN diagram, be

\beq\color{blue}
P(x_i|x_{<i}, u_i)=
\indi(
x_i=\sum_{k<i}\alp_{i|k}x_k
 + u_i)
\;,
\label{eq-linear-pa-tpm}
\eeq
for some parameters $\alp_{i|k}\in \RR$.
The exogenous 
nodes $\rvu.$  are assumed
to be independent so

\beq
P(u.)=\prod_i P(u_i)
\eeq
and

\beq
\av{\rvu_i, \rvu_j}=0
\text{  if $i\neq j$}
\;.
\eeq
Note that

\beqa
P(x.)&=&\sum_{u.}P(u.)
\prod_i P(x_i|x_{<i}, u_i)
\\
&=&
E_{\rvu.}[\prod_i P(x_i|x_{<i}, u_i)]
\;.
\eeqa


In terms of random variables,
this system
is described by the following 
{\bf structural equations}:

\beq
\rvx_i=\sum_{k<i}\alp_{i|k}\rvx_k
 + \rvu_i
\;.
\eeq
The structural equations can be
written in matrix form
as follows.
Define a strictly lower triangular
matrix $A$
with the connection 
strengths $\alp_{i|k}\in \RR$
as entries.
For example, for $nx=4$,

\beq
A=
\left[
\begin{array}{cccc}
0&0&0&0
\\
\alp_{1|0}&0&0&0
\\
\alp_{2|0}&\alp_{2|1}&0&0
\\
\alp_{3|0}&\alp_{3|1}&\alp_{3|2}&0
\end{array}\right]
\;.
\eeq
If we now represent the multinodes
$\rvx.$ and $\rvu.$ as column vectors
$\rvx$ and $\rvu$, we get

\beq
\rvx = A \rvx +\rvu
\label{eq-mat-fully-conn}
\;.
\eeq
Note that

\beq
\rvx=(1-A)^{-1}\rvu
\;.
\eeq
Therefore,


\beq
\rvx_i=f_i(\rvu_{\leq i})
\;.
\eeq
Therefore,
if $i>j$,

\beq
\av{\rvu_i, \rvx_j}
=\av{\rvu_i, f_j(\rvu_{\leq j})}=0
\;.
\eeq
Thus, if $i>j$, 

\beqa
\av{\rvx_i, \rvx_j}&=&
\sum_{k<i}\alp_{i|k}\av{\rvx_k, \rvx_j}
+
\av{\rvu_i, \rvx_j}
\\
&=&
\sum_{k<i}\alp_{i|k}\av{\rvx_k, \rvx_j}
\;.
\label{eq-alp-covs-gen}
\eeqa
In matrix notation, 
Eq.(\ref{eq-alp-covs-gen}) becomes

\beq
\av{\rvx, \rvx^T}_L=A[\av{\rvx, \rvx^T}_L + 
\av{\rvx,\rvx^T}_D]
\eeq
where
we are
using 
$\av{\rvx, \rvx^T}_{i, j}=
\av{\rvx_i, \rvx_j}$
and denoting
the strictly lower triangular part
and diagonal part
of a matrix $M$ by $M_L$  
and $M_D$. Thus,

\beq
A = \av{\rvx, \rvx^T}_L[\av{\rvx, \rvx^T}_L
+ \av{\rvx, \rvx^T}_D]^{-1}
\;.
\eeq
This gives an estimate
for the $\alp$'s
in terms of the
 covariances $\av{\rvx_i, \rvx_j}$.

\section{Non-linear DEN diagrams}
This chapter 
is dedicated to
linear DEN diagrams. This
implicitly
assumes that 
the deterministic
nodes $\rvx.$
of the 
DEN diagram have
an interval of
real values as their
possible states.
A trivial
but very useful
generalization
of linear DEN diagrams is to
replace Eq.(\ref{eq-linear-pa-tpm})
for the TPMs
of the
deterministic nodes
of the diagram by

\beq\color{blue}
P(x_i|x_{<i}, u_i)=
\indi(
x_i=f_i(x_{<i}, u_i))
\;,
\label{eq-nonlinear-pa-tpm}
\eeq
with structural equations

\beq
\rvx_i=f_i(\rvx_{<i}, \rvu_i)
\;,
\label{eq-pa-nonlinear-struc}
\eeq
for $i=0, 1, \ldots, nx-1$.
Here the $f_i$ are 
possibly non-linear
functions
that depend
the states
$x_{<i}$ and $u_i$
of nodes $\rvx_{<i}$
and $\rvu_i$.
If a node $\rvx_i$
has no arrows
entering it (i.e., is
a root node), then

\beq\color{blue}
P(x_i|x_{<i}, u_i)=P(x_i)=\delta(x_i, a)
\eeq
and

\beq
\rvx_i=a
\eeq
for some $a\in S_{\rvx_i}$.


With this generalization,
we can make any
$f_i()$
represent a
continuous probability
distribution
such as a Gaussian,
or a discrete-valued Boolean
function
such as an OR gate.


Eqs.(\ref{eq-nonlinear-pa-tpm})
and (\ref{eq-pa-nonlinear-struc})
are the TPMs and
structural equations
for a 
fully connected, non-linear DEN diagram.
For a non-fully connected 
diagram, 
\begin{itemize}
\item
replace the multinode $x_{<i}$
by a subset of itself,
in 
Eqs.(\ref{eq-nonlinear-pa-tpm})
and (\ref{eq-pa-nonlinear-struc})
,
and
\item
delete
the corresponding arrows
from the graph.
\end{itemize}

