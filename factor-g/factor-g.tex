\chapter{Factor Graphs}
\label{ch-factor-g}

Consider a product $g=\prod_{\alp=0}^{nf-1} f_\alp$
of scalar functions
 $f_\alp:\rvx_{A_\alp}\rarrow \RR$,
where $A_\alp\subset
\{0,1,\ldots, nx-1\}$. For instance,
consider $g:S_{\rvx_0},
\times S_{\rvx_1} \times S_{\rvx_2}\rarrow \RR$
defined by:

\beq
g(x_0,x_1,x_2) = f_0(x_0)
f_1(x_0,x_1)f_2(x_0,x_1)f_3(x_1,x_2)
\label{eq-g-fun}
\;.
\eeq
The {\bf factor graph}
for this function $g$
 is given by Fig.\ref{fig-fac-graph}.


\begin{figure}[h!]
\centering
$$\xymatrix{
*++[o][F]{x_0}\ar@{-}[d]\ar@{-}[dr]\ar@{-}[drr]
&*++[o][F]{x_1}\ar@{-}[d]\ar@{-}[dr]\ar@{-}[drr]
&*++[o][F]{x_2}\ar@{-}[dr]
\\
*+[F]{f_0}
&*+[F]{f_1}
&*+[F]{f_2}
&*+[F]{f_3}
}$$
\caption{Factor graph for function
$g$ defined by Eq.(\ref{eq-g-fun}).}
\label{fig-fac-graph}
\end{figure}

\begin{figure}[h!]
\centering
$$\xymatrix{
\rvx_0\ar[d]\ar[dr]\ar[drr]
&\rvx_1\ar[d]\ar[dr]\ar[drr]
&\rvx_2\ar[dr]
\\
\rvf_0&\rvf_1&\rvf_2&\rvf_3
}$$
\caption{Bipartite bnet
corresponding to factor
graph Fig.\ref{fig-fac-graph}.}
\label{fig-bip-bnet}
\end{figure}

A {\bf Markov Random Field (MRF)}
is a 
statistical model whose
probability distribution
is of the form
$P(x^{nx})=\caln(!x^{nx})\prod_\alpha f_\alp$,
so it can be represented graphically 
by a factor graph.

One
can map
any factor graph (the ``source")
to a special bipartite bnet (the ``image"),
as follows.
Replace each $x_i$ by $\rvx_i\in S_{\rvx_i}$
for $i=0,1, \ldots, nx-1$
 and each
 $f_\alpha$ by $\rvf_\alpha$
for $\alpha=0, 1, \ldots, nf-1$.
Then replace
the connections (edges)
of the factor graph
by arrows from $\rvx_i$ to
$\rvf_\alpha$. 
\footnote{Pointing arrows
from the $\rvx_i$
to the $\rvf_\alp$
is more causal than
the opposite because
the $\rvx_i$
preceed the $f_\alp$
in time.}
For example,
Fig.\ref{fig-bip-bnet}
is the image bipartite bnet of the source factor
graph Fig.\ref{fig-fac-graph}.


Let $\rvx^{nx}=
(\rvx_0, \rvx_1, \ldots, \rvx_{nx-1})$
and
$\rvf^{nf}=
(\rvf_0, \rvf_1, \ldots, \rvf_{nf-1})$.
Let\footnote{
Note that we are using
$f_\alpha$
to denote both a function
$f_\alp(\cdot)$  and a Boolean
value. Which one we mean
will be clear from context.
$f_\alp$ could also be used to
denote, besides a function and a Boolean value,
the real number
$y_\alp=f_\alpha(x_{nb(\rvf_\alpha)})$.
However, we won't be using it that third way
in this chapter.}
$f_\alp\in \bool$ for all $\alp$,
and $y_\alp=
f_\alpha(x_{nb(\rvf_\alpha)})$.
Here we are using $nb(\rvf_\alp)$
to denote  the neighborhood
of node $\rvf_\alp$
in the image bipartite bnet,
and we are using $x_S$ to denote
$(x_i)_{i\in S}$.
Without loss of
generality,
we will assume
that $y_\alp\in[0,1]$ for all $\alp$.
Then we define the TPMs, printed
in blue, for the
image bipartite bnet, 
as follows.




\beq\color{blue}
P(f_\alpha|x_{nx(\rvf_\alpha)})=
y_\alp
\delta(f_\alp, 1)
+
[1-y_\alp]
\delta(f_\alp, 0)
\;
\eeq
for $\alp=0, 1, \ldots , nf-1$
and

\beq\color{blue}
P_{\rvx_i}(x_i)= \text{arbitrary prior}
\eeq
for $i=0, 1, \ldots, nx-1$.

Note that

\beq
P(f^{nf}=1^{nf}|x^{nx})=
\prod_\alpha
f_\alpha(x_{nb(\rvf_\alpha)})
\;.
\eeq

We've shown
how to go from a factor graph
to a bnet.
Going from a
bnet to a factor graph
is also possible.
Fig.\ref{fig-bnet-2-fg}
gives a simple example.
Bnet  to factor
graph conversion
is used in the Junction Tree
Algorithm (See Chapter \ref{ch-junc-tree}).
\begin{figure}[h!]
$$
\begin{array}{ccc}
\xymatrix{
\rva_1\ar[dr]
&
&\rva_2\ar[dl]
\\
&\rvx\ar[dr]\ar[dl]
\\
\rvb_1
&
&\rvb_2
}
&
\xymatrix{\\
\rdart}
&
\xymatrix@R=.7pc{
*++[o][F]{a_1}\ar@{-}[dr]
&
&*++[o][F]{a_2}\ar@{-}[dl]
\\
&*+[F]{P(x|a_1)P(x|a_2)}\ar@{-}[d]
\\
&*++[o][F]{x}\ar@{-}[dr]\ar@{-}[dl]
\\
*+[F]{P(b_1|x)}\ar@{-}[d]
&
&*+[F]{P(b_2|x)}\ar@{-}[d]
\\
*++[o][F]{b_1}
&
&*++[o][F]{b_2}
}
\end{array}
$$
\caption{
Example
of converting a bnet
to a factor graph.}
\label{fig-bnet-2-fg}
\end{figure}





